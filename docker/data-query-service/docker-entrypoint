#!/bin/sh

set -e

# Set default values for ENV's variables
export HOST=${HOST:-'ws://localhost:8546'}
export CONTRACT_ADDRESS=${CONTRACT_ADDRESS:-'0x0000000000000000000000000000000000000010'}
export ORACLE_ADDRESS=${ORACLE_ADDRESS:-'0x00DC7B3229F23C975E0510FDb9cBcC4e695729Fd'}
export ORACLE_PK=${ORACLE_PK:-'0xe42a402291dfaa427e87c669b790949ed6b307e6e4af01eb8a9af3c4c369cb22'}
export RSA_PUBLIC=${RSA_PUBLIC:-'-----BEGIN PUBLIC KEY-----\r\nMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAhduRshn7DGqtLZQxtJdu\r\nwwp/oY2LLwgd0l/3ejhScZtw8XOC4z380O3uG9NMIJOKnrIpU3og0EN1uEkL8tNY\r\n1YpfnrdHQYS1C+cJuv4f8wh2/p3BtczyaXS8M+VEZR9aPniVoT6HMYi9gqLvPhVx\r\n3qGD91Wixm38VEUXhBy+imB0XyxDLy5qsq3YLCBqTSsA/c7ihsTbHoGh/GBHmOgB\r\nzz2TGPypb90UiJSLWIPAzy85TC+jtUAM4TvzMO1T8lCud6ONQJ7syPcdw/xvE6ka\r\ne3lcccQMjP5XEpRaV5QQR6JwotQLEH19r6ALLDtmwX0EMOAp9VVPfpwbnqXkaQEP\r\nmQIDAQAB\r\n-----END PUBLIC KEY-----\r\n'}
export RSA_PRIVATE=${RSA_PRIVATE:-'-----BEGIN RSA PRIVATE KEY-----\r\nMIIEowIBAAKCAQEAhduRshn7DGqtLZQxtJduwwp/oY2LLwgd0l/3ejhScZtw8XOC\r\n4z380O3uG9NMIJOKnrIpU3og0EN1uEkL8tNY1YpfnrdHQYS1C+cJuv4f8wh2/p3B\r\ntczyaXS8M+VEZR9aPniVoT6HMYi9gqLvPhVx3qGD91Wixm38VEUXhBy+imB0XyxD\r\nLy5qsq3YLCBqTSsA/c7ihsTbHoGh/GBHmOgBzz2TGPypb90UiJSLWIPAzy85TC+j\r\ntUAM4TvzMO1T8lCud6ONQJ7syPcdw/xvE6kae3lcccQMjP5XEpRaV5QQR6JwotQL\r\nEH19r6ALLDtmwX0EMOAp9VVPfpwbnqXkaQEPmQIDAQABAoIBAFSfs0Q9WJFI/6LJ\r\nBYN+GPAFOxsPOObK4s+VDAegg75+3rBGroCrN6F+SgIdWwtdO02IpMe5dfU0MMAI\r\nrh0dsBOQH1Nf2xR4qVyU+3nUHq6us0vUwBoHL1msCy9jyhGD+LF12mLN/Po70FM+\r\nXrGJLSvqQFulL/rynYtJAszqvysLU0nlEb5x2IG7R+Gt54evtlSo9pFpNwoIttqL\r\nZLgFVTaGzV1bWgN4xdbLdAwpXhwL2MZZKhVEmpy4zLKCgs9U8hevLBVOGC2WKcNu\r\nDC26pqCzB30wqPovq8RdpWvnDcHSMkoZRIx6byrLX0uWGndBCbOzm0+b7d6uUFzi\r\nORPlOmECgYEA1CVEr1Cl5oQKX3HiimuEbl1u3VtbGES2P4B4GGT+aTsThZhdgP91\r\nf2wOFAkhRUDwCTvD/A46kB+zJKVbqNXbikEyB2Pf6nQJ8O1SymRNeCBdmqrrSyzf\r\nb5rkB3IMVXe1Ac45meUVvkSHZB28IO/KuWbSw0jS0fXQbSOMmoXUO1sCgYEAoYdP\r\ndTNiEONueOUDPhxUSI1/PYFsYM9qZZP3Nz0krrMh32hY0olM4cfXz5hcJDpmmnlm\r\nEQw2q9rfATDef/JxeYzjrw9AIwgr214NvgT6hqd32Dd/ZYQmxrg8cqu36gNJMyQ2\r\nsyxNIbP9jUKpjDlt3+Q3uDbSFsCgSZ+DVFQu9xsCgYBeu1mlc7zxZ8r9/evsZcCY\r\nS+6iuBXAi4ZaavK16ftVYEUCZhxy6yA7yzOqLL2HoEzPwrlsh6oNC6rCVXjNttm3\r\nLg+6DxZBKpn51PAgYpPZbZJ+643wXtRTkPX8gSgSzkaszLsaBpskAJP41/JXPtzm\r\n14yMGavSiBMPeU1i/xnbewKBgEZLBCEUw1BmKOUjhE27NlJ8gSra77cRjFO4GJVJ\r\nXnVILy1x03WLmpGGzjvhKff6EjyXJ/uzPPd8wB9cjPdRImCrF0pPcLHOFIfaXlCb\r\nCgsfReAqBp6+68D+3A9q+xYzZ9+BmuxOEyLfmS+oGvCS7WXJgxX/hV2xZg+kAxrn\r\np6iRAoGBAMK8xUzBwAXAoBXjCOKHiMHhREef9nHLqFUCtnCVqUG0mmCfancnUhb/\r\niwO+7j5mVgyIUvVlcpCAck3xtLVxe08k6PePhEo/0zW5oLxzsFyJt2hWrKFDZuvY\r\nKfoCM7sAOGc1kUO04e3NgLdeQ3cLTbHVrgq+VSYRMOGNJ34bGe0i\r\n-----END RSA PRIVATE KEY-----\r\n'}

# Process config files
envsubst '${HOST} ${CONTRACT_ADDRESS} ${ORACLE_ADDRESS} ${ORACLE_PK}' < /app/config/config.docker.json > /app/config/config.json
envsubst '${RSA_PUBLIC} ${RSA_PRIVATE}' < /app/config/rsaKeys.docker.json > /app/config/rsaKeys.json

# Start app
npm start